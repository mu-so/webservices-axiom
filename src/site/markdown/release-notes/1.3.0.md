Apache Axiom 1.3.0 Release Note
===============================

Changes in this release
-----------------------

*   Axiom now requires at least Java 6. Explicit dependencies on APIs that were
    not part of the JRE in Java 5 (Activation, StAX and JAXB) have been removed.

*   The public API now uses generics. Note that this should in general not have
    impact on binary compatibility with Axiom 1.2.x.

*   The `getDataHandler()` method defined by `OMText` has been modified to use
    `DataHandler` instead of `Object` as return type.

*   The builder implementations and related classes have been removed from the
    `org.apache.axiom.om.impl.builder` and `org.apache.axiom.soap.impl.builder`
    packages. This includes the `StAXBuilder`, `StAXOMBuilder`,
    `XOPAwareStAXOMBuilder`, `StAXSOAPModelBuilder` and `MTOMStAXSOAPModelBuilder`
    classes.

    This change was necessary to enable a refactoring and complete overhaul of
    the builders.

    As explained in the Axiom 1.2.11 release notes, application code
    should use the `OMXMLBuilderFactory` API to create builders. Code written for
    Axiom 1.2.x that uses that API remains compatible with Axiom 1.3.x.

*   The `BuilderAwareReader` API introduced by [AXIOM-268][] has been removed
    without replacement. There are multiple reasons for this:

    *   The only method defined by the `BuilderAwareReader` interface has a
        parameter of type `StAXBuilder`, but that class has been removed from
        the public API (see above). The parameter type would have to be changed
        to `OMXMLParserWrapper`.
    *   If the interface is considered a public API, then it is placed in the
        wrong package (`org.apache.axiom.om.impl.builder`).
    *   There are no known usages of that API.
    *   The API is merely a convenience, but doesn't provide any additional
        feature: since a builder only starts consuming the `XMLStreamReader` on
        demand, a reference to the builder can be injected into the custom
        "builder aware" reader after the builder has been created.

[AXIOM-268]: https://issues.apache.org/jira/browse/AXIOM-268

*   Some (most? all?) of the classes in `axiom-compat` have been removed.

*   Support for the `SOAPConstants.SOAPBODY_FIRST_CHILD_ELEMENT_QNAME` property
    introduced by [AXIOM-282][] has been retired.

[AXIOM-282]: https://issues.apache.org/jira/browse/AXIOM-282

*   The legacy behavior for `getChildrenWithName` implemented by [AXIOM-11][]
    is no longer supported. In Axiom 1.3.0 the QName matching is always strict.

[AXIOM-11]: https://issues.apache.org/jira/browse/AXIOM-11

*   Elements no longer store line number information, and the corresponding
    methods on the `OMElement` interface have been deprecated.

*   The `CustomBuilder` and `CustomBuilderSupport` interfaces have changed in
    an incompatible way. Note that this API was designed to enable some very
    specific optimizations in Axis2, so that this change should have limited
    impact.
    
    In addition to the interface changes, the API no longer gives access to the
    raw `XMLStreamReader` returned by the StAX implementation. That feature was
    originally introduced to allow negotiation of additional optimizations
    between proprietary StAX and JAXB implementations from a particular vendor.
    That feature is no longer necessary and has been removed to allow a
    simplification of the builder design.

*   In Axiom 1.2.x, `StAXUtils` by default kept per class loader maps of
    `XMLInputFactory` and `XMLOutputFactory` instances (where the key was the
    thread context class loader). These maps were implemented as
    `WeakHashMap<ClassLoader,XMLInputFactory>` and `WeakHashMap<ClassLoader,XMLOutputFactory>`.
    The problem with this approach is that it may cause a class loader leak if
    the `XMLInputFactory` or `XMLOutputFactory` instance has a strong reference
    to the `ClassLoader` used as key. That case occurs in two scenarios:

    1.  A StAX implementation is loaded by a class loader that is neither the
        class loader that loads StAXUtils nor one of its parent class loaders,
        and that class loader is set as the context class loader when
        `StAXUtils` is used. Note that this is basically the use case for which
        the per class loader maps were originally designed.
    2.  For whatever reason, the `XMLInputFactory`/`XMLOutputFactory` instance
        keeps a strong reference to the thread context class loader set when
        the instance was created. In that scenario, if `StAXUtils` is used with
        a thread context class loader that is set to any class loader other than
        the one that loaded `StAXUtils` or one of its parents, then `StAXUtils`
        will prevent that class loader from being garbage collected. This type
        of behavior has been [reported](http://markmail.org/message/2kfstgjckrgiimmt)
        for the default StAX implementation in the Oracle JRE; Woodstox is
        probably not affected.

    The scenario for which the per class loader feature was designed is probably
    very rare. As shown above, that scenario is always prone to class loader
    leaks. Therefore this feature has been removed without replacement in Axiom
    1.3.0, and `StAXUtils` now always loads the StAX implementation visible to
    its own class loader. Note that this mode was already supported in Axiom
    1.2.x, but it was not the default.

*   The `getNodeValue` and `setNodeValue` methods have been removed from the
    `SOAPFaultNode` interface because they conflict with methods defined by
    DOM's `Node` interface. Note that these methods were already deprecated in
    Axiom 1.2.x, with alternative methods being available.
